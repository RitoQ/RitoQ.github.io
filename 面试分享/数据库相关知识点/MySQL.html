<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL知识点 | Rito的技术文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/style.css">
    <script charset="utf-8" src="/js/custom.js"></script>
    <meta name="description" content="点赞、转发、收藏">
    <meta name="keywords" content="Rito的技术文档,vuepress,自建博客,Rito">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="robots" content="all">
    <meta name="author" content="Rito">
    
    <link rel="preload" href="/assets/css/0.styles.57064493.css" as="style"><link rel="preload" href="/assets/js/app.5dd80075.js" as="script"><link rel="preload" href="/assets/js/4.1f5ea5ee.js" as="script"><link rel="preload" href="/assets/js/1.d44b9672.js" as="script"><link rel="preload" href="/assets/js/20.c4c014bc.js" as="script"><link rel="preload" href="/assets/js/26.188c0215.js" as="script"><link rel="prefetch" href="/assets/js/10.c0f5bb11.js"><link rel="prefetch" href="/assets/js/11.94610362.js"><link rel="prefetch" href="/assets/js/12.97d298a0.js"><link rel="prefetch" href="/assets/js/13.15fd9cb8.js"><link rel="prefetch" href="/assets/js/14.be289ceb.js"><link rel="prefetch" href="/assets/js/15.aa792dae.js"><link rel="prefetch" href="/assets/js/16.c4c98eca.js"><link rel="prefetch" href="/assets/js/17.a690d9f4.js"><link rel="prefetch" href="/assets/js/18.f5dc4f1c.js"><link rel="prefetch" href="/assets/js/19.7d26c4a9.js"><link rel="prefetch" href="/assets/js/21.73add8e0.js"><link rel="prefetch" href="/assets/js/22.0c58d9fb.js"><link rel="prefetch" href="/assets/js/23.b5f07714.js"><link rel="prefetch" href="/assets/js/24.0f386a03.js"><link rel="prefetch" href="/assets/js/25.e91cda51.js"><link rel="prefetch" href="/assets/js/27.c4fc14b6.js"><link rel="prefetch" href="/assets/js/28.38d9e0aa.js"><link rel="prefetch" href="/assets/js/29.463b0af0.js"><link rel="prefetch" href="/assets/js/30.ca7ea9e1.js"><link rel="prefetch" href="/assets/js/31.b97d44a3.js"><link rel="prefetch" href="/assets/js/32.44930a17.js"><link rel="prefetch" href="/assets/js/33.3d453f75.js"><link rel="prefetch" href="/assets/js/34.2fb305b8.js"><link rel="prefetch" href="/assets/js/35.381490dd.js"><link rel="prefetch" href="/assets/js/36.a1744722.js"><link rel="prefetch" href="/assets/js/37.88ed3c60.js"><link rel="prefetch" href="/assets/js/38.f982df4e.js"><link rel="prefetch" href="/assets/js/39.c8dcfd2c.js"><link rel="prefetch" href="/assets/js/40.c66c9107.js"><link rel="prefetch" href="/assets/js/41.77b6a5c4.js"><link rel="prefetch" href="/assets/js/42.7536e10c.js"><link rel="prefetch" href="/assets/js/43.e76ae62c.js"><link rel="prefetch" href="/assets/js/5.a39974b4.js"><link rel="prefetch" href="/assets/js/6.b6ad8df3.js"><link rel="prefetch" href="/assets/js/7.640b1fd0.js"><link rel="prefetch" href="/assets/js/8.9d61be7c.js"><link rel="prefetch" href="/assets/js/9.0371782b.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.9be24d21.js">
    <link rel="stylesheet" href="/assets/css/0.styles.57064493.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-4698c43e><div data-v-4698c43e><div id="loader-wrapper" class="loading-wrapper" data-v-1c4f0192 data-v-4698c43e data-v-4698c43e><div class="loader-main" data-v-1c4f0192><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-6cbeab0a data-v-4698c43e data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a>Rito的技术文档</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>Rito</span>
            
          <span data-v-6cbeab0a>2022 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-4698c43e><header class="navbar" data-v-4698c43e><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Rito的技术文档</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont reco-eye"></i>
  本站指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      技术分享
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/java笔记/01-基础知识.html" class="nav-link"><i class="iconfont undefined"></i>
  Java基础
</a></li></ul></li><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/前端/Html/HTML&amp;CSS.html" class="nav-link"><i class="iconfont undefined"></i>
  Html&amp;Css
</a></li><li class="dropdown-subitem"><a href="/技术文章/前端/Js/js.html" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/技术文章/前端/Vue2/vue2.html" class="nav-link"><i class="iconfont undefined"></i>
  Vue2
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-faq"></i>
      面试分享
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/面试分享/集合相关知识点/HashMap知识点.html" class="nav-link"><i class="iconfont undefined"></i>
  集合相关知识点
</a></li><li class="dropdown-item"><!----> <a href="/面试分享/数据库相关知识点/MySQL.html" class="nav-link"><i class="iconfont undefined"></i>
  数据库相关知识点
</a></li><li class="dropdown-item"><h4>开发框架相关知识点</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/面试分享/开发框架相关知识点/spring/spring知识点.html" class="nav-link"><i class="iconfont undefined"></i>
  spring
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-blog"></i>
      个人博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/rito-blog/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-blog"></i>
  博客园
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-4698c43e></div> <aside class="sidebar" data-v-4698c43e><div class="personal-info-wrapper" data-v-6c8ffc9c><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-6c8ffc9c> <h3 class="name" data-v-6c8ffc9c>
    Rito
  </h3> <div class="num" data-v-6c8ffc9c><div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>4</h3> <h6 data-v-6c8ffc9c>文章</h6></div> <div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>8</h3> <h6 data-v-6c8ffc9c>标签</h6></div></div> <hr data-v-6c8ffc9c></div> <nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont reco-eye"></i>
  本站指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      技术分享
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/java笔记/01-基础知识.html" class="nav-link"><i class="iconfont undefined"></i>
  Java基础
</a></li></ul></li><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/前端/Html/HTML&amp;CSS.html" class="nav-link"><i class="iconfont undefined"></i>
  Html&amp;Css
</a></li><li class="dropdown-subitem"><a href="/技术文章/前端/Js/js.html" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/技术文章/前端/Vue2/vue2.html" class="nav-link"><i class="iconfont undefined"></i>
  Vue2
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-faq"></i>
      面试分享
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/面试分享/集合相关知识点/HashMap知识点.html" class="nav-link"><i class="iconfont undefined"></i>
  集合相关知识点
</a></li><li class="dropdown-item"><!----> <a href="/面试分享/数据库相关知识点/MySQL.html" class="nav-link"><i class="iconfont undefined"></i>
  数据库相关知识点
</a></li><li class="dropdown-item"><h4>开发框架相关知识点</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/面试分享/开发框架相关知识点/spring/spring知识点.html" class="nav-link"><i class="iconfont undefined"></i>
  spring
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-blog"></i>
      个人博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/rito-blog/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-blog"></i>
  博客园
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>数据库相关知识点</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/面试分享/数据库相关知识点/MySQL.html" class="active sidebar-link">MySQL知识点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/面试分享/数据库相关知识点/MySQL.html#一、b树和b-树之间的区别是什么" class="sidebar-link">一、B树和B+树之间的区别是什么?</a></li><li class="sidebar-sub-header"><a href="/面试分享/数据库相关知识点/MySQL.html#二、innodb中的b-树是怎么产生的" class="sidebar-link">二、Innodb中的B+树是怎么产生的？</a></li><li class="sidebar-sub-header"><a href="/面试分享/数据库相关知识点/MySQL.html#三、高度为3的b-树能存多少条数据" class="sidebar-link">三、高度为3的B+树能存多少条数据?</a></li><li class="sidebar-sub-header"><a href="/面试分享/数据库相关知识点/MySQL.html#四、innodb引擎是如何支持范围查找能走索引的" class="sidebar-link">四、Innodb引擎是如何支持范围查找能走索引的?</a></li><li class="sidebar-sub-header"><a href="/面试分享/数据库相关知识点/MySQL.html#五、为什么要遵守最左前缀原则才能利用到索引" class="sidebar-link">五、为什么要遵守最左前缀原则才能利用到索引?</a></li><li class="sidebar-sub-header"><a href="/面试分享/数据库相关知识点/MySQL.html#六、范围查找导致索引失效原理分析" class="sidebar-link">六、范围查找导致索引失效原理分析？</a></li><li class="sidebar-sub-header"><a href="/面试分享/数据库相关知识点/MySQL.html#七、覆盖索引的底层原理" class="sidebar-link">七、覆盖索引的底层原理？</a></li><li class="sidebar-sub-header"><a href="/面试分享/数据库相关知识点/MySQL.html#八、索引扫描底层原理" class="sidebar-link">八、索引扫描底层原理？</a></li><li class="sidebar-sub-header"><a href="/面试分享/数据库相关知识点/MySQL.html#九、order-by为什么会导致索引失效" class="sidebar-link">九、order by为什么会导致索引失效？</a></li><li class="sidebar-sub-header"><a href="/面试分享/数据库相关知识点/MySQL.html#十、mysql中的数据类型转换需要注意哪些" class="sidebar-link">十、MySQL中的数据类型转换需要注意哪些？</a></li><li class="sidebar-sub-header"><a href="/面试分享/数据库相关知识点/MySQL.html#十一-对字段进行操作导致索引失效原理" class="sidebar-link">十一.对字段进行操作导致索引失效原理</a></li></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-6cbeab0a data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>Rito</span>
            
          <span data-v-6cbeab0a>2022 - </span>
          2022
        </a></span></div></div> <div data-v-4698c43e><main class="page"><!----> <div class="page-title" style="display:none;"><h1>MySQL知识点</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>Rito</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="mysql知识点"><a href="#mysql知识点" class="header-anchor">#</a> MySQL知识点</h1> <h2 id="一、b树和b-树之间的区别是什么"><a href="#一、b树和b-树之间的区别是什么" class="header-anchor">#</a> 一、B树和B+树之间的区别是什么?</h2> <p>首先附上数据结构可视化工具网址</p> <p><strong>https://www.cs.usfca.edu/~galles/visualization/Algorithms.html</strong></p> <h3 id="_1、b树"><a href="#_1、b树" class="header-anchor">#</a> 1、B树</h3> <p><img src="/assets/img/image-20221117194723699.2c288c19.png" alt="image-20221117194723699"></p> <p>这里的 B 是 Balance（平衡）的缩写。它是一种多路的平衡搜索树。
它跟普通的平衡二叉树的不同是，B树的每个节点可以存储多个数据，而且每个节点不止有两个子节点，最多可以有上千个子节点。
B树中每个节点都存放着索引和数据，数据遍布整个树结构，搜索可能在非叶子节点结束，最好的情况是O(1)。
一般一棵 B 树的高度在 3 层左右，3 层就可满足 百万级别的数据量</p> <h3 id="_2、b-树"><a href="#_2、b-树" class="header-anchor">#</a> 2、B+树</h3> <p><img src="/assets/img/image-20221117195134033.c2854182.png" alt="image-20221117195134033"></p> <p>B+树是B树的一种变种，它与 B树 的 区别 是：</p> <p>叶子节点保存了完整的索引和数据，而非叶子节点只保存索引值，因此它的查询时间固定为 log(n)
叶子节点中有指向下一个叶子节点的指针，叶子节点类似于一个单链表
正因为叶子节点保存了完整的数据以及有指针作为连接，B+树可以增加了区间访问性，提高了范围查询，而B树的范围查询相对较差</p> <p>B+树更适合外部存储。因为它的非叶子节点不存储数据，只保存索引。</p> <h2 id="二、innodb中的b-树是怎么产生的"><a href="#二、innodb中的b-树是怎么产生的" class="header-anchor">#</a> 二、Innodb中的B+树是怎么产生的？</h2> <p>往数据库中添加一些无序的数据，查询语句后发现数据顺序按照a字段排序,可是在查询时并没有使用order by 字段，所以只能是在插入时已经排好序。</p> <p><img src="/assets/img/image-20221117233257557.b07d153b.png" alt="image-20221117233257557"></p> <p><img src="/assets/img/image-20221117233327831.cad2e2d1.png" alt="image-20221117233327831"></p> <p>想要解决这个问题我们要从Innodb引擎是怎样搭建B+树的</p> <p>Innodb引擎中，最小的存储单元就是一页，一页为16kb</p> <p><img src="/assets/img/image-20221117234720681.15c9d042.png" alt="image-20221117234720681"></p> <p>现假设一个页仅能存下三条记录，随着用户记录不断插入，InnoDB不断申请新的索引页，最终结构如下图所示：</p> <p><img src="https://img-blog.csdnimg.cn/img_convert/f8282c1663e43f6b33e3350bea382797.png" alt="image.png"></p> <p>现在我们要查询id=10的记录，InnoDB会怎么做呢？很遗憾，只能从页1开始一个页一个页的往后找。InnoDB会先将页1从磁盘加载到内存，然后遍历用户记录，判断是否存在id=10的记录，没有找到则继续加载页2，然后重复前面的过程，这就是「全表扫描」。当然，这个查找的过程也可以偷懒。首先，页内的记录无需全部遍历，通过Page Directory使用二分法即可快速查找。其次，找到第一条id&gt;10的记录就不用再往后找了，因为记录是按照id排好序的，后面的记录id也肯定也比10大。
尽管可以偷点懒，但可惜的是效果微乎其微，内存的读写速度和CPU的算力已经非常快了，整个过程最耗时的操作其实是将页从磁盘加载到内存里，这需要发起系统调用来读取磁盘数据。这些页在物理上可能还不是连续的，机械硬盘随机读的效率是非常低的，如果每次检索数据都要全表扫描一次，这是完全不能接受的。</p> <p>有没有发现？索引页本身其实和页内记录的分组很像，页内的记录是有序的，页与页之间也是有序的。于是，InnoDB直接借鉴了Page Directory的设计，将每个索引页内最小的主键值提取出来，给所有的索引页再建立一个目录。目录项最少要记录主键值+页号，例如上图中的记录，先给页1创建一个目录项，存储主键值1和页号1；再给页2创建一个目录项，存储主键值4和页号2；以此类推。这些目录项存在哪里呢？有没有发现目录项和用户记录也很像？只是用户记录存储的是用户自定义的列数据，而目录项存储的是主键值+页号。所以，InnoDB直接使用索引页来存储目录项，把目录项和用户记录同等对待，只在记录头信息里通过record_type属性做区分，0是用户记录，1是目录项记录 ，除此之外两者结构完全一样。存放目录项记录的页类型和存放用户记录的页类型也是一样的，都是0x45BF。目录项之间也是有序的单向链表，也可以通过Page Directory快速查找等等。</p> <p><img src="https://img-blog.csdnimg.cn/img_convert/1f0ba27870b3214ca6ff94161178274f.png" alt="image.png"></p> <p>现在我们再来看一下，有索引的情况下，InnoDB通过主键查找记录的流程。先将B+树的根节点页面加载到内存，通过Page Directory使用二分法快速定位到分组，遍历组内的目录项， 通过页号定位到第二层页节点，将该节点页加载到内存，重复前面的过程，直到定位到叶子节点页，最终获取到记录。加载数据页的个数，其实就是B+树的高度，而且InnoDB B+树有个特点，就是根节点一旦确定就不会改变，这样InnoDB就可以将根节点页做缓存了，进一步减少页的加载次数。</p> <h2 id="三、高度为3的b-树能存多少条数据"><a href="#三、高度为3的b-树能存多少条数据" class="header-anchor">#</a> 三、高度为3的B+树能存多少条数据?</h2> <p>前面我们说到了Innodb引擎中，最小的存储单元就是一页，一页为16kb，磁盘存储数据最小的单元为扇区，一个扇区的大小为512字节，而文件系统的最小单元是块，一个块的大小是4k，因此Innodb的所有数据文件，他的大小始终都是16384B的整数倍。</p> <p>数据表中的数据都是存储在页中的，所以一个页中能存储多少行数据呢？<strong>假设一行数据的大小是1k，那么一个页可以存放16行这样的数据。</strong></p> <p>但是除了有 <code>存放数据的页</code> 以外，还有 <code>存放键值+指针（索引）的页</code> ，即B+树中的非叶子节点，该页存放键值和指向数据页的指针，这样的页由N个（键值+指针）组成。当然它也是排好序的。 这样的数据组织形式，我们称为「索引组织表」。索引组织表通过非叶子节点的「二分查找法」以及指针确定数据在哪个页中，进而在去数据页中查找到需要的数据。</p> <p>这里我们先假设B+树高为2，即存在一个根节点和若干个叶子节点，没有子页节点，那么这棵B+树的存放总记录数为：<code>根节点指针数*单个叶子节点记录行数</code>。</p> <p>那么现在我们需要计算出非叶子节点能存放多少指针，也就是存放多少索引？</p> <p>我们假设主键ID为 <code>bigint</code> 类型，长度为8字节，而 <code>指针大小在InnoDB源码中设置为6字节</code> ，这样一共14字节。</p> <p>我们一个页中能存放多少这样的单元，其实就代表有多少指针，即 16384/14=1170。一个页能存放1170个索引</p> <p>那么可以算出一棵高度为2的B+树，能存放1170*16=18720条这样的数据记录。</p> <p>根据同样的原理我们可以算出一个高度为3的B+树可以存放：1170（根存的记录指针数据）✖1170（下一级每个节点存的记录指针数据）✖16（每个叶子阶段存的数据条数）=21902400 条这样的记录，即2100w量级。</p> <p>所以在InnoDB中B+树高度一般为1-3层，它就能满足千万级的数据存储。</p> <p>在查找数据时一次页的查找代表一次 <code>IO</code> ，所以通过主键索引查询通常只需要1-3次 <code>IO</code> 操作即可查找到数据，即使一个是千万量级的表，也是很快的。</p> <h2 id="四、innodb引擎是如何支持范围查找能走索引的"><a href="#四、innodb引擎是如何支持范围查找能走索引的" class="header-anchor">#</a> 四、Innodb引擎是如何支持范围查找能走索引的?</h2> <p><code>select * from t1 where a &gt; 6</code>是先执行a=6的操作，先找到a=6之后，再把a&gt;6之后的所有数据全部返回就可以了。如果是&lt;，就需要返回6之前的数据。</p> <p><img src="https://img-blog.csdnimg.cn/891d5a997cdc4d0cb5768e283b7e4d52.png" alt="在这里插入图片描述"></p> <p>为了方便查找，Innodb引擎在每页之间添加了双向链表，如下图所示</p> <p><img src="https://img2022.cnblogs.com/blog/2984731/202211/2984731-20221120142334896-1754785280.png" alt="image-20221118210004330"></p> <h2 id="五、为什么要遵守最左前缀原则才能利用到索引"><a href="#五、为什么要遵守最左前缀原则才能利用到索引" class="header-anchor">#</a> 五、为什么要遵守最左前缀原则才能利用到索引?</h2> <p>创建一个bcd的联合索引 <code>create index idx_t1_bcd on t1(b,c,d)</code>，那么他也会生成一个B+树，那么这个b+树是怎么生成的呢？ 我们主键索引所对应的B+树是按照主键锁对应的元素进行排序，然后生成B+树。那么bcd索引所对应的B+树也是一个道理，也就是把这几条数据按照bcd三个字段进行排序就可以了。但是叶子节点呢？叶子节点如果存放全部数据的话，每次增删改查数据都要对着两个B+树进行操作，相当的麻烦，所有在联合索引的叶子节点上，不存放其他元素的值，只存bcd三个字段的值和主键的索引。是因为我们如果借用bcd所有来查询，查到的元素只有bcd，还需要一个主键，进行回表操作，根据主键值在主键B+树查找完整的信息。</p> <p><img src="https://img-blog.csdnimg.cn/229ee0d24bb147be85ac40c6867957fb.png" alt="在这里插入图片描述"></p> <p><strong>最左前缀原则</strong>：where的条件，和你给的索引顺序无关（底层会给你优化排序），但必须包含最左侧的字段。比如这个查询就会使索引失效<code>select * from t1 where c = 1 and t = 1</code>，没有用到a字段。这种情况就 相当于给的条件是<code>* 1 1</code>，想要走bcd的索引，然后跟<code>111</code>和<code>322</code>比较，看往左走还是往右走。
这是没办法比较的，因为条件的最左边字段没给。但如果条件是<code>b=1 and d=1</code>是能走的，这就好比<code>1 * 1</code>，这是可以比较的，数据一定在左边，因为左边的a比右边的a小。</p> <h2 id="六、范围查找导致索引失效原理分析"><a href="#六、范围查找导致索引失效原理分析" class="header-anchor">#</a> 六、范围查找导致索引失效原理分析？</h2> <p>假如还是bcd来联合索引，这次的查询条件<code>explain select * from t1 where b &gt; 1</code>,索引是会失效，走到是全表扫描。因为查到b=1后，还需要拿着主键的索引去回表查询，后面的数据过多是很麻烦的，所用的时间还不如全表扫描。</p> <h2 id="七、覆盖索引的底层原理"><a href="#七、覆盖索引的底层原理" class="header-anchor">#</a> 七、覆盖索引的底层原理？</h2> <p><code>explain select b from t1 where b &gt; 1;</code>这个是能够走索引的，因为这个只需要查到b，以bcd为索引的B+树是包含b的值，所以不需要回表查询。这就叫<strong>覆盖索引</strong>，sql里面所查询的字段正好就在当前sql当前所利用的索引，上面有这个字段，不用回表。</p> <h2 id="八、索引扫描底层原理"><a href="#八、索引扫描底层原理" class="header-anchor">#</a> 八、索引扫描底层原理？</h2> <p><code>explain select b from t1</code>这个sql也是能够走bcd索引的。如果是走全表扫描，是从主键索引的叶子节点去遍历，把每条数据的b字段给取出来。b字段的值即会存在主键索引当中，还会存在bcd索引的B+树中。如果是在bcd的叶子节点去遍历，遍历的数据没有主键索引的数据完整，但都包含b字段的值，查询的速度肯定是不完整的数据比完整的快，所以走的会是bcd索引</p> <h2 id="九、order-by为什么会导致索引失效"><a href="#九、order-by为什么会导致索引失效" class="header-anchor">#</a> 九、order by为什么会导致索引失效？</h2> <p><code>explain select * from t order by b,c,d;</code>这个sql是无法走索引的，因为联合字段的B+树是按照索引字段进行排序的，可我们要查的是* ，bcd存放的数据不完整，需要回表查询，存了几条数据就需要回几次表。而全表扫描是在内存中进行的，<strong>内存的操作要比io快得多</strong>。</p> <h2 id="十、mysql中的数据类型转换需要注意哪些"><a href="#十、mysql中的数据类型转换需要注意哪些" class="header-anchor">#</a> 十、MySQL中的数据类型转换需要注意哪些？</h2> <p>在varchar类型中，<strong>不是数字的字符如果转换为数字的话会统统转成0</strong>，比如<code>'123' = 123</code> , <code>'abc' = 0</code></p> <h2 id="十一-对字段进行操作导致索引失效原理"><a href="#十一-对字段进行操作导致索引失效原理" class="header-anchor">#</a> 十一.对字段进行操作导致索引失效原理</h2> <p>只要对字段进行的操作都会导致索引失效，比如<code>select * from t1 where a+1 = 1</code>，改b+树，它会该字段，该字段，其他查询就不能继续走这个索引，所以索引的字段万万不能改变。</p></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----></main> <!----> <div class="comments-wrapper" data-v-4698c43e><!----></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div><!----><div></div><!----><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="https://music.163.com/song/media/outer/url?id=316756.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://p2.music.126.net/qOOTIykbSLw9RHB0vI83GA==/737772302281958.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://p2.music.126.net/qOOTIykbSLw9RHB0vI83GA==/737772302281958.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>大城小事</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>杨千嬅</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><!----></div></div>
    <script src="/assets/js/app.5dd80075.js" defer></script><script src="/assets/js/4.1f5ea5ee.js" defer></script><script src="/assets/js/1.d44b9672.js" defer></script><script src="/assets/js/20.c4c014bc.js" defer></script><script src="/assets/js/26.188c0215.js" defer></script>
  </body>
</html>
